
#include "numerics/elliptic.hpp"
#include "gtest/gtest.h"

namespace principia {
namespace numerics {

class EllipticTest : public ::testing::Test {};

// TODO(phl): This is far from covering all the code paths.  In particular, it
// doesn't seem to go through Elcbdj.
TEST_F(EllipticTest, Xelbdj) {
  constexpr double PI = 3.1415926535897932384626433;
  constexpr double PIHALF = 1.5707963267948966192313216916398;
  double dnc, dmc, dphi, nc, nn, mc, mm, phi, phic, b, d, j;
  int lend, kend, iend;

  lend = 5;
  kend = 5;
  iend = 4;
  dnc = 1.0 / static_cast<double>(lend - 1);
  dmc = 1.0 / static_cast<double>(kend - 1);
  dphi = PIHALF / static_cast<double>(iend);
  std::printf(
      "%10s%10s%10s%25s%25s%25s\n", "n", "m", "phi/PI", "elb", "eld", "elj");
  for (int l = 1; l <= lend; ++l) {
    nc = static_cast<double>(l - 1) * dnc;
    if (nc <= 1.05e-8) {
      nc = 1.05e-8;
    }
    float rnc = static_cast<float>(nc);
    if (rnc <= 2.44e-4) {
      nc = 2.44e-4;
    }
    nn = 1.0 - nc;
    for (int k = 1; k <= kend; ++k) {
      std::printf("\n");
      mc = static_cast<double>(k - 1) * dmc;
      if (mc <= 0.0) {
        mc = 1.21e-32;
      }
      mm = 1.0 - mc;
      for (int i = 0; i <= iend; ++i) {
        phi = dphi * static_cast<double>(i);
        phic = dphi * static_cast<double>(iend - i);
        Elbdj(phi, phic, nn, mc, b, d, j);
        std::printf("%10.5f%10.5f%10.5f%25.15f%25.15f%25.15f\n",
                    nn,
                    mm,
                    phi / PI,
                    b,
                    d,
                    j);
      }
    }
  }
}
/*
======================================================================================================
          n         m    phi/PI                      elb                      eld                      elj           relb           reld           relj

    0.99976   1.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.99976   1.00000   0.12500        0.382683432365090        0.020516286796422        0.022570343177599      0.3826835      0.0205163      0.0225703
    0.99976   1.00000   0.25000        0.707106781186548        0.174266805832995        0.266382481911311      0.7071068      0.1742668      0.2663825
    0.99976   1.00000   0.37500        0.923879532511287        0.691011383661808        2.345064868304662      0.9238795      0.6910112      2.3450634
    0.99976   1.00000   0.50000        1.000000000000000       37.132345669220292   136391.378049815393751      1.0000000     37.1323471 136379.5937500

    0.99976   0.75000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.99976   0.75000   0.12500        0.380165874573813        0.020265117017211        0.022288926653528      0.3801659      0.0202651      0.0222889
    0.99976   0.75000   0.25000        0.687224290919399        0.163999458151786        0.249346408412777      0.6872242      0.1639994      0.2493464
    0.99976   0.75000   0.37500        0.861000430354716        0.559500504346794        1.787983458054265      0.8610005      0.5595005      1.7879827
    0.99976   0.75000   0.50000        0.895902820924732        1.260612826574912      196.395167222240275      0.8959028      1.2606128    196.3863678

    0.99976   0.50000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.99976   0.50000   0.12500        0.377737820324691        0.020024676408965        0.022019650853618      0.3777378      0.0200247      0.0220197
    0.99976   0.50000   0.25000        0.670355132106078        0.155662744143168        0.235645434075686      0.6703551      0.1556627      0.2356454
    0.99976   0.50000   0.37500        0.820671634698681        0.491035758158865        1.522223602858838      0.8206718      0.4910357      1.5222231
    0.99976   0.50000   0.50000        0.847213084793979        1.006861592507393      139.562982684668469      0.8472131      1.0068617    139.5567474

    0.99976   0.25000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.99976   0.25000   0.12500        0.375393116925529        0.019794159144289        0.021761598305347      0.3753931      0.0197942      0.0217616
    0.99976   0.25000   0.25000        0.655685639148294        0.148680462083772        0.224260632101247      0.6556856      0.1486805      0.2242606
    0.99976   0.25000   0.37500        0.790322477603527        0.445663694750517        1.354561202879649      0.7903225      0.4456636      1.3545605
    0.99976   0.25000   0.50000        0.812597772919921        0.873152581892676      114.192493470516609      0.8125978      0.8731526    114.1874008

    0.99976   0.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.99976   0.00000   0.12500        0.373126236145999        0.019572845552725        0.021513950041333      0.3731263      0.0195729      0.0215140
    0.99976   0.00000   0.25000        0.642699081698724        0.142699081698724        0.214572870954856      0.6426990      0.1426991      0.2145729
    0.99976   0.00000   0.37500        0.765825317844723        0.412271927251449        1.235274252890637      0.7658252      0.4122718      1.2352737
    0.99976   0.00000   0.50000        0.785398163397448        0.785398163397448       99.013293263192892      0.7853982      0.7853982     99.0088959

    0.75000   1.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.75000   1.00000   0.12500        0.382683432365090        0.020516286796422        0.022012232717184      0.3826835      0.0205163      0.0220122
    0.75000   1.00000   0.25000        0.707106781186548        0.174266805832995        0.233634924921085      0.7071068      0.1742668      0.2336349
    0.75000   1.00000   0.37500        0.923879532511287        0.691011383661808        1.383967203057269      0.9238795      0.6910112      1.3839667
    0.75000   1.00000   0.50000        1.000000000000000       37.132345669220292      146.446614706473639      1.0000000     37.1323471    146.4466095

    0.75000   0.75000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.75000   0.75000   0.12500        0.380165874573813        0.020265117017211        0.021739095264120      0.3801659      0.0202651      0.0217391
    0.75000   0.75000   0.25000        0.687224290919399        0.163999458151786        0.219075035542894      0.6872242      0.1639994      0.2190750
    0.75000   0.75000   0.37500        0.861000430354716        0.559500504346794        1.086438640019290      0.8610005      0.5595005      1.0864384
    0.75000   0.75000   0.50000        0.895902820924732        1.260612826574912        3.583611283698927      0.8959028      1.2606128      3.5836115

    0.75000   0.50000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.75000   0.50000   0.12500        0.377737820324691        0.020024676408965        0.021477710411120      0.3777378      0.0200247      0.0214777
    0.75000   0.50000   0.25000        0.670355132106078        0.155662744143168        0.207328297405433      0.6703551      0.1556627      0.2073283
    0.75000   0.50000   0.37500        0.820671634698681        0.491035758158865        0.938149197056845      0.8206718      0.4910357      0.9381490
    0.75000   0.50000   0.50000        0.847213084793979        1.006861592507393        2.768720224791972      0.8472131      1.0068617      2.7687201

    0.75000   0.25000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.75000   0.25000   0.12500        0.375393116925529        0.019794159144289        0.021227191478047      0.3753931      0.0197942      0.0212272
    0.75000   0.25000   0.25000        0.655685639148294        0.148680462083772        0.197541942156515      0.6556856      0.1486805      0.1975419
    0.75000   0.25000   0.37500        0.790322477603527        0.445663694750517        0.842350424403990      0.7903225      0.4456636      0.8423502
    0.75000   0.25000   0.50000        0.812597772919921        0.873152581892676        2.357292208141529      0.8125978      0.8731526      2.3572924

    0.75000   0.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.75000   0.00000   0.12500        0.373126236145999        0.019572845552725        0.020986746876685      0.3731263      0.0195729      0.0209868
    0.75000   0.00000   0.25000        0.642699081698724        0.142699081698724        0.189196072805552      0.6426990      0.1426991      0.1891961
    0.75000   0.00000   0.37500        0.765825317844723        0.412271927251449        0.773098374942894      0.7658252      0.4122718      0.7730982
    0.75000   0.00000   0.50000        0.785398163397448        0.785398163397448        2.094395102393195      0.7853982      0.7853982      2.0943952

    0.50000   1.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.50000   1.00000   0.12500        0.382683432365090        0.020516286796422        0.021485423570639      0.3826835      0.0205163      0.0214854
    0.50000   1.00000   0.25000        0.707106781186548        0.174266805832995        0.209074775614900      0.7071068      0.1742668      0.2090748
    0.50000   1.00000   0.37500        0.923879532511287        0.691011383661808        1.020774439803883      0.9238795      0.6910112      1.0207740
    0.50000   1.00000   0.50000        1.000000000000000       37.132345669220292       73.771790377879654      1.0000000     37.1323471     73.7717972

    0.50000   0.75000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.50000   0.75000   0.12500        0.380165874573813        0.020265117017211        0.021220059796666      0.3801659      0.0202651      0.0212201
    0.50000   0.75000   0.25000        0.687224290919399        0.163999458151786        0.196323448596668      0.6872242      0.1639994      0.1963234
    0.50000   0.75000   0.37500        0.861000430354716        0.559500504346794        0.813099999300043      0.8610005      0.5595005      0.8130999
    0.50000   0.75000   0.50000        0.895902820924732        1.260612826574912        2.156515647499643      0.8959028      1.2606128      2.1565156

    0.50000   0.50000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.50000   0.50000   0.12500        0.377737820324691        0.020024676408965        0.020966085381627      0.3777378      0.0200247      0.0209661
    0.50000   0.50000   0.25000        0.670355132106078        0.155662744143168        0.186009725832904      0.6703551      0.1556627      0.1860097
    0.50000   0.50000   0.37500        0.820671634698681        0.491035758158865        0.707394438302897      0.8206718      0.4910357      0.7073943
    0.50000   0.50000   0.50000        0.847213084793979        1.006861592507393        1.694426169587957      0.8472131      1.0068617      1.6944258

    0.50000   0.25000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.50000   0.25000   0.12500        0.375393116925529        0.019794159144289        0.020722642399758      0.3753931      0.0197942      0.0207226
    0.50000   0.25000   0.25000        0.655685639148294        0.148680462083772        0.177399255346557      0.6556856      0.1486805      0.1773993
    0.50000   0.25000   0.37500        0.790322477603527        0.445663694750517        0.638278769417304      0.7903225      0.4456636      0.6382787
    0.50000   0.25000   0.50000        0.812597772919921        0.873152581892676        1.455842298777197      0.8125978      0.8731526      1.4558423

    0.50000   0.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.50000   0.00000   0.12500        0.373126236145999        0.019572845552725        0.020488964835011      0.3731263      0.0195729      0.0204890
    0.50000   0.00000   0.25000        0.642699081698724        0.142699081698724        0.170043175939310      0.6426990      0.1426991      0.1700432
    0.50000   0.00000   0.37500        0.765825317844723        0.412271927251449        0.587897023961480      0.7658252      0.4122718      0.5878969
    0.50000   0.00000   0.50000        0.785398163397448        0.785398163397448        1.301290284568573      0.7853982      0.7853982      1.3012904

    0.25000   1.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.25000   1.00000   0.12500        0.382683432365090        0.020516286796422        0.020987613506348      0.3826835      0.0205163      0.0209876
    0.25000   1.00000   0.25000        0.707106781186548        0.174266805832995        0.189834190890406      0.7071068      0.1742668      0.1898342
    0.25000   1.00000   0.37500        0.923879532511287        0.691011383661808        0.820455985054876      0.9238795      0.6910112      0.8204558
    0.25000   1.00000   0.50000        1.000000000000000       37.132345669220292       49.378311174069594      1.0000000     37.1323471     49.3783150

    0.25000   0.75000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.25000   0.75000   0.12500        0.380165874573813        0.020265117017211        0.020729558156099      0.3801659      0.0202651      0.0207296
    0.25000   0.75000   0.25000        0.687224290919399        0.163999458151786        0.178468021910232      0.6872242      0.1639994      0.1784680
    0.25000   0.75000   0.37500        0.861000430354716        0.559500504346794        0.659754278441750      0.8610005      0.5595005      0.6597542
    0.25000   0.75000   0.50000        0.895902820924732        1.260612826574912        1.580795429464887      0.8959028      1.2606128      1.5807955

    0.25000   0.50000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.25000   0.50000   0.12500        0.377737820324691        0.020024676408965        0.020482551737041      0.3777378      0.0200247      0.0204826
    0.25000   0.50000   0.25000        0.670355132106078        0.155662744143168        0.169255411762512      0.6703551      0.1556627      0.1692554
    0.25000   0.50000   0.37500        0.820671634698681        0.491035758158865        0.576869776220026      0.8206718      0.4910357      0.5768697
    0.25000   0.50000   0.50000        0.847213084793979        1.006861592507393        1.254178733860736      0.8472131      1.0068617      1.2541786

    0.25000   0.25000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.25000   0.25000   0.12500        0.375393116925529        0.019794159144289        0.020245763214615      0.3753931      0.0197942      0.0202458
    0.25000   0.25000   0.25000        0.655685639148294        0.148680462083772        0.161550873764594      0.6556856      0.1486805      0.1615509
    0.25000   0.25000   0.37500        0.790322477603527        0.445663694750517        0.522250714438824      0.7903225      0.4456636      0.5222507
    0.25000   0.25000   0.50000        0.812597772919921        0.873152581892676        1.083463697226561      0.8125978      0.8731526      1.0834637

    0.25000   0.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.25000   0.00000   0.12500        0.373126236145999        0.019572845552725        0.020018450492512      0.3731263      0.0195729      0.0200185
    0.25000   0.00000   0.25000        0.642699081698724        0.142699081698724        0.154959044897878      0.6426990      0.1426991      0.1549590
    0.25000   0.00000   0.37500        0.765825317844723        0.412271927251449        0.482215845099239      0.7658252      0.4122718      0.4822158
    0.25000   0.00000   0.50000        0.785398163397448        0.785398163397448        0.972012149757285      0.7853982      0.7853982      0.9720120

    0.00000   1.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.00000   1.00000   0.12500        0.382683432365090        0.020516286796422        0.020516286796422      0.3826835      0.0205163      0.0205163
    0.00000   1.00000   0.25000        0.707106781186548        0.174266805832995        0.174266805832995      0.7071068      0.1742668      0.1742668
    0.00000   1.00000   0.37500        0.923879532511287        0.691011383661808        0.691011383661808      0.9238795      0.6910112      0.6910112
    0.00000   1.00000   0.50000        1.000000000000000       37.132345669220292       37.132345669220300      1.0000000     37.1323471     37.1323471

    0.00000   0.75000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.00000   0.75000   0.12500        0.380165874573813        0.020265117017211        0.020265117017211      0.3801659      0.0202651      0.0202651
    0.00000   0.75000   0.25000        0.687224290919399        0.163999458151786        0.163999458151786      0.6872242      0.1639994      0.1639994
    0.00000   0.75000   0.37500        0.861000430354716        0.559500504346794        0.559500504346794      0.8610005      0.5595005      0.5595005
    0.00000   0.75000   0.50000        0.895902820924732        1.260612826574912        1.260612826574911      0.8959028      1.2606128      1.2606130

    0.00000   0.50000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.00000   0.50000   0.12500        0.377737820324691        0.020024676408965        0.020024676408965      0.3777378      0.0200247      0.0200247
    0.00000   0.50000   0.25000        0.670355132106078        0.155662744143168        0.155662744143168      0.6703551      0.1556627      0.1556627
    0.00000   0.50000   0.37500        0.820671634698681        0.491035758158865        0.491035758158865      0.8206718      0.4910357      0.4910357
    0.00000   0.50000   0.50000        0.847213084793979        1.006861592507393        1.006861592507393      0.8472131      1.0068617      1.0068614

    0.00000   0.25000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.00000   0.25000   0.12500        0.375393116925529        0.019794159144289        0.019794159144289      0.3753931      0.0197942      0.0197942
    0.00000   0.25000   0.25000        0.655685639148294        0.148680462083772        0.148680462083772      0.6556856      0.1486805      0.1486805
    0.00000   0.25000   0.37500        0.790322477603527        0.445663694750517        0.445663694750517      0.7903225      0.4456636      0.4456636
    0.00000   0.25000   0.50000        0.812597772919921        0.873152581892676        0.873152581892676      0.8125978      0.8731526      0.8731526

    0.00000   0.00000   0.00000        0.000000000000000        0.000000000000000        0.000000000000000      0.0000000      0.0000000      0.0000000
    0.00000   0.00000   0.12500        0.373126236145999        0.019572845552725        0.019572845552725      0.3731263      0.0195729      0.0195729
    0.00000   0.00000   0.25000        0.642699081698724        0.142699081698724        0.142699081698724      0.6426990      0.1426991      0.1426991
    0.00000   0.00000   0.37500        0.765825317844723        0.412271927251449        0.412271927251449      0.7658252      0.4122718      0.4122718
    0.00000   0.00000   0.50000        0.785398163397448        0.785398163397448        0.785398163397448      0.7853982      0.7853982      0.7853982
======================================================================================================
*/

}  // namespace numerics
}  // namespace principia
