\documentclass[10pt, a4paper, oneside]{basestyle}
\usepackage[Mathematics]{semtex}
\usepackage{chngcntr}
\counterwithout{equation}{section}

%%%% Shorthands.

%%%% Title and authors.

\title{%
\textdisplay{%
Geopotential%
}%
}
\author{Pascal~Leroy (phl)}
\begin{document}
\maketitle
\begin{sloppypar}
\noindent
This document describes the computations that are performed by the method \texttt{GeneralSphericalHarmonicsAcceleration} of class \texttt{Geopotential} to the determine the acceleration exerted by a non-spherical celestial on a point mass.
\end{sloppypar}

Let $\vr$ be the vector going from the centre of the celestial to the point mass.  Let $\tuple{\vx, \vy, \vz}$ be a (direct) base whose $\vz$ axis is along the axis of rotation of the celestial and whose $\vx$ axis points toward a reference point on the celestial.  In this base $\vr$ has coordinates $\tuple{x, y, z}$ which can be expressed in terms of the latitude $\gb$ and the longitude $\gl$:
\[
\vr=\begin{pmatrix}
x \\ y \\ z
\end{pmatrix}
=\begin{pmatrix}
r \cos \gb \cos \gl\\
r \cos \gb \sin \gl\\
r \sin \gb
\end{pmatrix}
\]
where $r$ is the norm of $\vr$.

The gravitational potential exerted by the celestial has the form:
\[
U\of\vr = -\frac{\gm}{r}\pa{1 + \sum{n = 1}[\infty] \sum{m = 0}[n] 
\pa{\frac{R}{r}}^n P_{m n}\of{\sin \gb}
\pa{C_{m n} \cos m \gl + S_{m n} \sin m \gl}
}
\]
where $P_{m n}$ is the associated Legendre function defined as:
\[
P_{m n} = \pa{1 - t^2}^{\frac{m}{2}} \deriv[m] t {P_n\of t}
\]
The terms that are relevant for evaluating the acceleration exerted by the spherical harmonics on the point mass have the form:
\[
V_{n m}\of\vr = \frac{1}{r}\pa{\frac{R}{r}}^n P_{m n}\of{\sin \gb}
\pa{C_{m n} \cos m \gl + S_{m n} \sin m \gl}
\]
and the acceleration itself is proportional to $\grad V_{n m}\of\vr$.

$V_{n m}\of\vr$ can be written as the product of a radial term, a latitudinal term and a longitudinal term, dependent of $r$, $\gb$, and $\gl$, respectively:
\[
V_{n m}\of\vr = {\mathfrak R\of r}\,{\mathfrak B\of \gb}\,{\mathfrak L\of \gl}
\]
where:
\[
\begin{cases}
\mathfrak R\of r &= \frac{1}{r}\pa{\frac{R}{r}}^n\\
\mathfrak B\of \gb &= P_{m n}\of{\sin \gb}\\
\mathfrak L\of \gl &= C_{m n} \cos m \gl + S_{m n} \sin m \gl
\end{cases}
\]
The overall gradient can then be written as:
\[
\grad V_{n m}\of\vr = 
{\grad \mathfrak R\of r}\,{\mathfrak B\of \gb}\,{\mathfrak L\of \gl} +
{\mathfrak R\of r}\,{\grad \mathfrak B\of \gb}\,{\mathfrak L\of \gl} +
{\mathfrak R\of r}\,{\mathfrak B\of \gb}\,{\grad \mathfrak L\of \gl}
\]
To compute this expression, we first determine the gradient of various elements appearing in the potential.  Starting with the $\mathfrak R$ term, we have trivially:
\[
\grad r^2 = \grad\of{x^2 + y^2 + z^2} = 2 \vr
\]
from which we deduce:
\[
\grad r^n = \grad\of{\pa{r^2}^{\frac{n}{2}}} = \frac{n}{2}\pa{r^2}^{\frac{n}{2} - 1}\pa{2 \vr} = n r^{n - 2} \vr
\]
Noting that $\grad z = \vz$ we can compute the following gradient needed for the $\mathfrak B$ term:
\[
\grad \sin \gb = \grad \frac{z}{r}
= \frac{r \vz - z r^{-1} \vr}{r^2} = \frac{\vz}{r} - \vr \frac{z}{r^3}
\]
which can be written, in coordinates:
\[
\grad \sin \gb =\frac{1}{r^3}\begin{pmatrix}
-x z \\ -y z \\ x^2 + y^2
\end{pmatrix}
=\frac{1}{r^3}\begin{pmatrix}
-r^2 \sin \gb \cos \gb \cos \gl \\
-r^2 \sin \gb \cos \gb \sin \gl \\
r^2 \cos^2 \gb
\end{pmatrix}
=\frac{\cos \gb}{r}\begin{pmatrix}
-\sin \gb \cos \gl \\
-\sin \gb \sin \gl \\
\cos \gb
\end{pmatrix}
\]
For the $\mathfrak L$ term, we need to evaluate:
\[
\begin{cases}
\grad \cos m \gl &= -m \sin m \gl \, \grad \gl \\
\grad \sin m \gl &= m \cos m \gl \, \grad \gl
\end{cases}
\]
The angle $\gl$ is $\arctan\frac{y}{x}$ thus:
\[
\grad \gl = \frac{1}{1 + \pa{\frac{y}{x}}^2} \grad\of{\frac{y}{x}}
= \frac{1}{1 + \pa{\frac{y}{x}}^2}\frac{x \vy - y \vx}{x^2}
= \frac{x \vy - y \vx}{x^2 + y^2}
\]
which can be written, in coordinates:
\[
\grad \gl = \frac{1}{x^2 + y^2}\begin{pmatrix}
-y \\
x \\
0
\end{pmatrix}
= \frac{1}{r^2 \cos^2 \gb}\begin{pmatrix}
-r \cos \gb \sin \gl \\
r \cos \gb \cos \gl \\
0
\end{pmatrix}
= \frac{1}{r \cos \gb}\begin{pmatrix}
-\sin \gl \\
\cos \gl \\
0
\end{pmatrix}
\]
\end{document}